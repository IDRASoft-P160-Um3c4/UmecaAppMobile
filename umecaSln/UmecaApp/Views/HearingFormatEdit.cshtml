@model UmecaApp.HearingFormatEditDto
@inherits WebViewTemplate
@{
	Layout = "UmecaApp.HeadSupervition";
}




<script>
app.controller('hearingFormatController', function ($scope, $timeout, $http, $q, $sce, $rootScope) {

        $scope.m = {};
        $scope.a = {};

        $scope.m.errTime;
        $scope.hasError = false;
        $scope.MsgError;
        $scope.MsgErrorContact = "";
        $scope.lblTerms = "";

        $scope.MsgErrorContact = "";

        $scope.m.labelImpForm = "";

        $scope.chnLblFormImp = function (id) {
            if ($scope.m.hasPrevHF == false) {
                if (id == 1) {
                    $scope.m.labelImpForm = $sce.trustAsHtml("Fecha de imputaci&oacute;n");
                    $scope.m.impDate = $scope.m.appointmentDate;
                }
                else if (id == 2) {
                    $scope.m.labelImpForm = $sce.trustAsHtml("Nueva fecha de audiencia");
                    $scope.m.impDate = "";
                }
            }
        };

        $scope.chnExtDate = function (id) {
            $scope.chngVincProcess(1);
            if (id == 1) {
                $scope.m.extDate = $scope.myFormatDate(((new Date()).getTime() + (86400000 * 3)));
            }
            else if (id == 2) {
                $scope.m.extDate = $scope.myFormatDate(((new Date()).getTime() + (86400000 * 6)));
            }
            else if (id == 3) {
                $scope.m.extDate = $scope.m.appointmentDate;
            }
        };

        var dlgConfirmAction = $('#divConfirm');

        $scope.showDlg = function () {
            var def = $q.defer();
            $timeout(function () {
                dlgConfirmAction.modal('show');
                dlgConfirmAction.on('hidden.bs.modal', function () {
                    if ($scope.IsOk === true) {

                    }
                    else {
                    }
                });
            }, 1);

            return def.promise;
        }

        $scope.hideDlg = function () {
            $scope.WaitFor = false;
            dlgConfirmAction.modal('hide');
        }

        $scope.validateSave = function () {

            $scope.hasError = false;

            $scope.validateBthDay();
            if ($scope.hasError == true) {
                $scope.MsgError = "No es posible guardar. Debe proporcionar toda la informaci&aacute;n requerida.";
                return false;
            }
            $scope.validateArrangementSel();
            if ($scope.hasError == true) {
                $scope.MsgError = "No es posible guardar. Debe proporcionar toda la informaci&aacute;n requerida.";
                return false;
            }
            $scope.validateLstContact();

            if ($scope.hasError == true) {
                $scope.MsgError = "No es posible guardar. Debe proporcionar toda la informaci&aacute;n requerida.";
                return false;
            }

            $rootScope.$broadcast('valAddCrime', $scope, "crimeIsValid");

            if ($scope.crimeIsValid == false) {
                $scope.MsgError = "No es posible guardar. Debe proporcionar toda la informaci&aacute;n requerida.";
                return false;
            }

            return true;
        };

        $scope.validateBthDay = function () {
            if (!$scope.m.impBthDay) {
                $scope.hasError = true;
                $scope.m.errBth = "Fecha de nacimiento es un campo requerido";
            }
            else {
                $scope.m.errBth = "";
                if ($scope.m.impAge < 18) {
                    $scope.hasError = true;
                    $scope.m.errAge = "No puede registrar a un menor de edad";
                }
                else
                    $scope.m.errAge = "";
            }
        }

        $scope.validateInitEnd = function () {
            if (Date.parse('01/01/2014 ' + $scope.m.initTime) >= Date.parse('01/01/2014 ' + $scope.m.endTime)) {
                $scope.hasError = true;
                $scope.m.errTime = "La hora de termino debe ser mayor a la hora de inicio";
                return;
            }
            else
                $scope.m.errTime = "";
        };

        $scope.addContact = function () {

            if ($scope.validateContact())
                return;

            var jsonRow = {
                "NameTxt": $scope.m.contactName,
                "PhoneTxt": $scope.m.contactPhone,
                "AddressTxt": $scope.m.contactAddress
            };

            $scope.m.lstContactData.push(jsonRow);

            $scope.m.contactName = "";
            $scope.m.contactPhone = "";
            $scope.m.contactAddress = "";
            $scope.MsgErrorContact = "";

        };

        $scope.validateContact = function () {
            $scope.MsgErrorContact = "";
            if ($scope.m.contactName === "" || $scope.m.contactPhone === "" || $scope.m.contactAddress === "" || !($scope.m.contactName) || !($scope.m.contactPhone) || !($scope.m.contactAddress)) {
                $scope.MsgErrorContact = "Debe proporcionar todos los campos para agregar el contacto."
                return true;
            }
            return false
        };

        $scope.removeContact = function (index) {
            if ($scope.m.canSave == true)
                $scope.m.lstContactData.splice(index, 1);
        };

        $scope.validateLstContact = function () {
            if ($scope.m.lstContactData == undefined || $scope.m.lstContactData.length < 1 && $scope.m.vincProcess == 1) {
                $scope.hasError = true;
                $scope.MsgErrorContact = "Debe registrar al menos un dato de contacto."
                return;
            }
            $scope.hasError = false;
            $scope.MsgErrorContact = "";
        };

        $scope.validateLinkProc = function () {

            if (!$scope.m.vincProcess) {
                $scope.hasError = true;
                $scope.m.errLinkProc = "Debe seleccionar una opción";
            }
            else
                $scope.m.errLinkProc = "";
            if ($scope.m.vincProcess == 1) {

                if (!$scope.m.linkageRoom || $scope.m.linkageRoom === "") {
                    $scope.hasError = true;
                    $scope.m.errLnkRoom = "Sala es un campo requerido";
                }
                else {
                    $scope.m.errLnkRoom = "";
                }

                if (!$scope.m.linkageDate || $scope.m.linkageDate === "") {
                    $scope.hasError = true;
                    $scope.m.errLnkDt = "Fecha es un campo requerido";
                }
                else {
                    $scope.m.errLnkDt = "";
                }

                if (!$scope.m.linkageTime || $scope.m.linkageTime === "") {
                    $scope.hasError = true;
                    $scope.m.errLnkTm = "Hora es un campo requerido";
                }
                else {
                    $scope.m.errLnkTm = "";
                }

            }
        };

        $scope.disableView = function (val) {

            if (val) {

                $("#divAudiencia :input").attr("disabled", true);
                $("#divImputado :input").attr("disabled", true);
                $("#divDelitos :input").attr("disabled", true);
                $("#divCtrlDet :input").attr("disabled", true);
                $("#divFormImp :input").attr("disabled", true);
                $("#divExt :input").attr("disabled", true);
                $("#divVincProc :input").attr("disabled", true);
                $("#divMedidas :input").attr("disabled", true);
                $("#divContact :input").attr("disabled", true);
                $("#divCitaUmeca :input").attr("disabled", true);
                $("#divPreviousHearing :input").attr("disabled", true);
                $(".arrangBoxSelector").attr("disabled", true);
                $(".arrangTextDescriptor").attr("disabled", true);

                $("#crimeAdder").remove();
                $(".notAviable").remove();

            }
            else {
                $("#divAudiencia :input").attr("disabled", false);
                $("#divImputado :input").attr("disabled", false);
                $("#divDelitos :input").attr("disabled", false);
                $("#divCtrlDet :input").attr("disabled", false);

                if ($scope.m.hasPrevHF == true) {
                    $("#idFolder").attr("disabled", true);
                    $("#idJudicial").attr("disabled", true);
                    $("#divFormImp :input").attr("disabled", true);
                }
                else
                    $("#divFormImp :input").attr("disabled", false);

                $("#divExt :input").attr("disabled", false);
                $("#divVincProc :input").attr("disabled", false);
                $("#divMedidas :input").attr("disabled", false);
                $("#divContact :input").attr("disabled", false);
            }

        };

        $scope.myFormatDate = function (dateMil) {

            var strDt = "";
            var date;


            console.log("dateMil->"+dateMil);
            if (dateMil && dateMil != "null") {

                date = new Date(dateMil);

                var dd, mm, yyyy;

                dd = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();
                mm = date.getMonth() < 9 ? '0' + (date.getMonth() + 1) : (date.getMonth() + 1);
                yyyy = date.getFullYear();
                if(yyyy > 0){
                	strDt = yyyy + "/" + mm + "/" + dd;
                }else{
                	strDt = "";
                }
            }
            console.log("strDt->"+strDt);

            return strDt;
        };

        $scope.fillFormat = function (data) {

            $scope.m.canSave = data.canSave;
            $scope.m.canEdit = data.canEdit;
            $scope.m.disableAll = data.disableAll;

            //audiencia
            $scope.m.idCase = data.idCase;
            $scope.m.idFormat = data.idFormat;
            $scope.m.isFinished = data.isFinished;
            $scope.m.hasPrevHF = data.hasPrevHF;
            $scope.m.idFolder = data.idFolder;
            $scope.m.idJudicial = data.idJudicial;
            $scope.m.room = data.room;
            $scope.m.appointmentDate = $scope.myFormatDate(data.appointmentDate);
            if ($scope.m.appointmentDate === "") {
                $scope.m.appointmentDate = $scope.myFormatDate(new Date());
            }
            $scope.m.initTime = data.initTime;
            $scope.m.endTime = data.endTime;
            $scope.m.judgeName = data.judgeName;
            $scope.m.mpName = data.mpName;
            $scope.m.defenderName = data.defenderName;

            //imputado
            $scope.m.imputedName = data.imputedName;
            $scope.m.imputedFLastName = data.imputedFLastName;
            $scope.m.imputedSLastName = data.imputedSLastName;
            $scope.m.impBthDay = $scope.myFormatDate(data.imputedBirthDate);
            $scope.calcAge();
            $scope.m.imputedTel = data.imputedTel;

            $scope.m.crimes = data.crimes;
            $scope.m.additionalData = data.additionalData;
            $scope.m.isView = data.isView;

            //radios
            $scope.m.ctrlDet = data.controlDetention;

                $scope.m.ext = data.extension;
            if (data.extDateStr != undefined && data.extDateStr != null && data.extDateStr != "" ) {
                $scope.m.extDate = $scope.myFormatDate(data.extDateStr);
            } else {
                $scope.m.extDate = "";
            }

            $scope.m.formImp = data.impForm;

            if ($scope.m.formImp == 1)
                $scope.m.labelImpForm = $sce.trustAsHtml("Fecha de imputaci&oacute;n");
            else if ($scope.m.formImp == 2)
                $scope.m.labelImpForm = $sce.trustAsHtml("Nueva fecha de audiencia");

            $scope.m.impDate = $scope.myFormatDate(data.imputationDate);

            $scope.m.vincProcess = data.vincProcess;
            $scope.m.linkageRoom = data.linkageRoom;
            $scope.m.linkageDate = $scope.myFormatDate(data.linkageDate);
            $scope.m.linkageTime = data.linkageTime;
            $scope.m.arrType = data.arrangementType;
            $scope.m.nationalArrangement = data.nationalArrangement;
            $scope.m.terms = data.terms;
            $scope.m.comments = data.comments;

            $scope.m.userName = data.userName;

            $scope.m.hearingTypeId = data.hearingTypeId;
            console.log("htype"+$scope.m.hearingTypeId);
            $scope.m.imputedPresence = data.imputedPresence;
            $scope.m.hearingTypeSpecification = data.hearingTypeSpecification;
            $scope.m.hearingResult = data.hearingResult;

            $scope.m.umecaDate = $scope.myFormatDate(data.umecaDate);
            $scope.m.umecaTime = data.umecaTime;
            $scope.m.umecaSupervisorId = data.umecaSupervisorId;

            if (data.lstArrangement != undefined)
                $scope.m.lstArrangementShow = $.parseJSON(data.lstArrangement);

            if (data.lstContactData != undefined){
                $scope.m.lstContactData = $.parseJSON(data.lstContactData);
                console.log("lstContactData+"+$scope.m.lstContactData);
            }else
                $scope.m.lstContactData = [];

            $scope.m.previousHearing = data.previousHearing;

            $scope.chgLblTerms();

            $scope.$apply();
        };


        $scope.saveHF = function () {
        askVerificationTerminate.hide();
        	var a = $scope.validateSave();
            var b = $scope.valAddedCrime();
            if ($("#FormFormatId").valid() == false || a == false || b == false) {
                $scope.Invalid = true;
                $scope.MsgError = $sce.trustAsHtml("No es posible terminar. Debe proporcionar toda la informaci&oacute;n requerida.");
                return false;
            }

            if ($scope.m.vincProcess == 2){
                askCloseCredentials.show();
            }else{
            		$scope.m.isFinished = true;

		            $scope.WaitFor = true;
		            $scope.m.listCrime = JSON.stringify($scope.listCrime);
		            $scope.m.controlDetention = $scope.m.ctrlDet;
		            $scope.m.impForm = $scope.m.formImp;
		            var listaContactos = $scope.m.lstContactData;
		            $scope.m.lstContactData = JSON.stringify($scope.m.lstContactData);
		            $scope.m.lstArrangement = JSON.stringify($scope.m.lstArrangementShow);
		            $scope.m.extension = $scope.m.ext;
		            $scope.m.extDateStr = $scope.m.extDate;
		            $scope.m.imputationDateStr = $scope.m.impDate;

		            var resultado = SupervisionService.upsertHearingFormat(JSON.stringify($scope.m));
		            var idformat = TryParseInt(resultado,null);
		            if(resultado!=undefined&&resultado!=null && idformat!=null){
		            	$scope.MsgSuccess = $sce.trustAsHtml("Se ha registrado el formato de audiencia.");
		            	$scope.WaitFor = false;
		            	$scope.m.idFormat = idformat;
		            	var mesage = "Se ha registrado el formato de audiencia.";
				 		console.log("regresar del idformat-"+idformat);
				 		var casoReferencia =$("#idCase").val();
				 		regresar(casoReferencia);
		            }else{
		            	$scope.MsgError = $sce.trustAsHtml(resultado);
		            	$scope.WaitFor = false;
		            	$scope.m.isFinished = false;
		            }
		             $scope.m.lstContactData = listaContactos;
		    }
        };

        $scope.saveHFClose = function () {
            		$scope.m.isFinished = true;
		            $scope.WaitFor = true;
		            $scope.m.listCrime = JSON.stringify($scope.listCrime);
		            $scope.m.controlDetention = $scope.m.ctrlDet;
		            $scope.m.impForm = $scope.m.formImp;
		            var listaContactos = $scope.m.lstContactData;
		            $scope.m.lstContactData = JSON.stringify($scope.m.lstContactData);
		            $scope.m.lstArrangement = JSON.stringify($scope.m.lstArrangementShow);
		            $scope.m.extension = $scope.m.ext;
		            $scope.m.extDateStr = $scope.m.extDate;
		            $scope.m.imputationDateStr = $scope.m.impDate;

		            var resultado = SupervisionService.upsertHearingFormat(JSON.stringify($scope.m));
		            var idformat = TryParseInt(resultado,null);
		            if(resultado!=undefined&&resultado!=null && idformat!=null){
		            	$scope.MsgSuccess = $sce.trustAsHtml("Se ha registrado el formato de audiencia.");
		            	$scope.WaitFor = false;
		            	$scope.m.idFormat = idformat;
		            	var mesage = "Se ha registrado el formato de audiencia.";
				 		console.log("regresar del idformat-"+idformat);
						window.location.replace('hybrid:Supervision/HearingFormatList?idCase='+$scope.m.idCase);
		            }else{
		            	$scope.MsgError = $sce.trustAsHtml(resultado);
		            	$scope.WaitFor = false;
		            	$scope.m.isFinished = false;
		            	askCloseCredentials.hide();
		            }
		             $scope.m.lstContactData = listaContactos;
		             $scope.$apply();
        };

        $scope.submitReloadHF = function (formId, urlToPost, validate) {

            var stVal = true;

            if (validate != undefined)
                stVal = validate();

            if (stVal == false) {
                $scope.Invalid = true;
                return false;
            }

            $scope.WaitFor = true;
            $scope.m.isFinished = true;

            $scope.WaitFor = true;
            $scope.m.isFinished = true;

            $timeout(function () {
                $.post(urlToPost, $(formId).serialize())
                    .success(function (resp) {
                        if (resp.hasError === undefined) {
                            resp = resp.responseMessage;
                        }

                        if (resp.hasError == false) {
                            window.goToUrlMvcUrl(resp.urlToGo);
                        }

                        if (resp.hasError == true) {
                            $scope.m.isFinished = false;
                            $scope.MsgError = $sce.trustAsHtml(resp.message);
                            $scope.$apply();
                        }
                    })
                    .error(function () {
                        $scope.WaitFor = false;
                        $scope.MsgError = $sce.trustAsHtml("Error de red. Por favor intente más tarde.");
                        $scope.$apply();
                    });
            }, 1);

        };

        /**/

        $scope.submitPartiaSaveHF = function () {
            $scope.WaitFor = true;
            $scope.m.listCrime = JSON.stringify($scope.listCrime);
            $scope.m.controlDetention = $scope.m.ctrlDet;
            $scope.m.impForm = $scope.m.formImp;
            var listaContactos = $scope.m.lstContactData;
            $scope.m.lstContactData = JSON.stringify($scope.m.lstContactData);
            $scope.m.lstArrangement = JSON.stringify($scope.m.lstArrangementShow);
		            $scope.m.extension = $scope.m.ext;
		            $scope.m.extDateStr = $scope.m.extDate;
		            $scope.m.imputationDateStr = $scope.m.impDate;

            var resultado = SupervisionService.upsertHearingFormat(JSON.stringify($scope.m));
            var idformat = TryParseInt(resultado,null);
            if(resultado!=undefined&&resultado!=null && idformat!=null){
            	$scope.MsgSuccess = $sce.trustAsHtml("Se ha registrado el formato de audiencia.");
            	$scope.WaitFor = false;
            	$scope.m.idFormat = idformat;
            	var mesage = "Se ha registrado el formato de audiencia.";
		 		console.log("regresar del idformat-"+idformat);
			
            }else{
            	$scope.MsgError = $sce.trustAsHtml(resultado);
            	$scope.WaitFor = false;
            }
             $scope.m.lstContactData = listaContactos;
             //$scope.$apply();
        };

        /**/

        $scope.loadArrangements = function () {

            if ($scope.m.arrType == undefined || $scope.m.arrType === '' || $scope.m.disableAll == true) {
                return;
            }
            if ($scope.m.nationalArrangement == undefined || ($scope.m.nationalArrangement === '') || $scope.m.disableAll == true) {
                return;
            }
            $scope.m.arrangementType = $scope.m.arrType;
            $scope.chgLblTerms();

            var data = SupervisionService.getArrangmentLst($scope.m.nationalArrangement, $scope.m.arrType);
            if(data!=undefined&&data!=""){
            	$scope.m.lstArrangementShow = $.parseJSON(data);
            }
        };

        $scope.calcAge = function () {

            //yyyy/mm/dd o en milisegundos
            if ($scope.m.impBthDay != null && $scope.m.impBthDay != "") {

                var arrBth = [];
                arrBth = $scope.m.impBthDay.split('/');

                var dtBthObj;

                if (arrBth.length > 0)
                    dtBthObj = new Date(parseInt(arrBth[0]), parseInt(arrBth[1]) - 1, parseInt(arrBth[2]));
                else
                    dtBthObj = new Date($scope.m.impBthDay);

                var ageDifMs = Date.now() - dtBthObj.getTime();
                var ageDate = new Date(ageDifMs);
                $scope.m.impAge = Math.abs(ageDate.getUTCFullYear() - 1970);

                if ($scope.m.impAge < 18) {
                    $scope.hasError = true;
                    $scope.m.errAge = "No puede registrar a un menor de edad";
                }
                else{
                    $scope.m.errAge = "";
                    $scope.m.imputedBirthDateStr = $scope.m.impBthDay;
                    }
                $scope.m.errBth = "";
            }
        };

        $scope.exclusiveSelected = function (idArr) {
            for (var i = 0; i < $scope.m.lstArrangementShow.length; i++) {
                if ($scope.m.lstArrangementShow[i].id != idArr && $scope.m.lstArrangementShow[i].selVal == true && $scope.m.lstArrangementShow[i].isExclusive == true) {
                    return $scope.m.lstArrangementShow[i].id
                }
            }

            return -1;
        };

        $scope.clearOthers = function (idExclusive) {
            for (var i = 0; i < $scope.m.lstArrangementShow.length; i++) {
                if ($scope.m.lstArrangementShow[i].id == idExclusive);
                else {
                    $scope.m.lstArrangementShow[i].selVal = false;
                    $scope.m.lstArrangementShow[i].description = "";
                }
            }
        };

        $scope.selectDefaults = function () {
            for (var i = 0; i < $scope.m.lstArrangementShow.length; i++) {
                if ($scope.m.lstArrangementShow[i].isDefault == true) {
                    $scope.m.lstArrangementShow[i].selVal = true;
                    $scope.m.lstArrangementShow[i].description = "";
                }
            }
        };

        $scope.validateArrangementSel = function (idx, idArr) {

            var noSel = 0;
            var noDesc = 0;

            var idExclusive = -1;

            if ($scope.m.vincProcess != 2) {

                if (!$scope.m.lstArrangementShow || $scope.m.disableAll == true)
                    return;

                if (idArr != undefined)
                    idExclusive = $scope.exclusiveSelected(idArr);

                if (idExclusive > 0) {
                    $scope.clearOthers(idExclusive);
                    $scope.m.errArrmntSel = $sce.trustAsHtml("No puede seleccionar otra medida cautelar. Debe deseleccionar la medida cautelar exclusiva.");
                    return;
                }

                if (idArr != undefined && idx != undefined)
                    if ($scope.m.lstArrangementShow[idx].isExclusive == true) {
                        $scope.clearOthers(idArr);
                    }

                if (idArr != undefined && idx != undefined)
                    if ($scope.m.lstArrangementShow[idx].isExclusive == true && $scope.m.lstArrangementShow[idx].selVal == false) {
                        $scope.selectDefaults();
                    }

                for (var i = 0; i < $scope.m.lstArrangementShow.length; i++) {

                    if ($scope.m.lstArrangementShow[i].selVal == true) {
                        noSel++;
                        if ($scope.m.lstArrangementShow[i].description != "" && $scope.m.lstArrangementShow[i].description != undefined) {
                            noDesc++;
                        }
                    } else {
                        $scope.m.lstArrangementShow[i].description = "";
                    }

                }

                if (noSel < 1) {
                    $scope.hasError = true;
                    $scope.m.errArrmntSel = $sce.trustAsHtml("Debe seleccionar al menos una obligaci&oacute;n procesal");
                    return;
                } else if (noSel > noDesc) {
                    $scope.hasError = true;
                    $scope.m.errArrmntSel = $sce.trustAsHtml("Debe indicar una descripci&oacute;n para cada obligaci&oacute;n procesal seleccionada");
                    return;
                } else {
                    $scope.m.errArrmntSel = $sce.trustAsHtml("");
                }
            }
        };

        $scope.hasContacts = function (id) {

            if (id == 2) {
                $scope.m.contactName = "NO TIENE";
                $scope.m.contactPhone = "00000000";
                $scope.m.contactAddress = "NO TIENE";
            } else {
                $scope.m.contactName = "";
                $scope.m.contactPhone = "";
                $scope.m.contactAddress = "";
            }
        };

        $scope.chngVincProcess = function (id) {
            if (id == 1 && $scope.m.ext == 3) {
                $scope.m.linkageRoom = $scope.m.room;
                $scope.m.linkageDate = $scope.m.appointmentDate;
                $scope.m.linkageTime = $scope.m.initTime;
            } else {
                $scope.m.linkageRoom = "";
                $scope.m.linkageDate = "";
                $scope.m.linkageTime = "";
            }
        };

        $scope.fillSelSupervisor = function () {

            if ($scope.lstSupervisor === undefined || $scope.lstSupervisor.length <= 0)
                return;

            if ($scope.m.umecaSupervisorId === undefined) {
                $scope.m.umecaSupervisor = $scope.lstSupervisor[0];
                $scope.m.umecaSupervisorId = $scope.m.umecaSupervisor.id;
            }
            else {
                for (var i = 0; i < $scope.lstSupervisor.length; i++) {
                    var rel = $scope.lstSupervisor[i];

                    if (rel.id === $scope.m.umecaSupervisorId) {
                        $scope.m.umecaSupervisor = rel;
                        break;
                    }
                }
            }
        };

        $scope.fillSelHearingType = function () {

                if ($scope.lstHearingType === undefined || $scope.lstHearingType.length <= 0)
                    return;

                if ($scope.m.hearingTypeId === undefined) {
                    $scope.m.hearingType = $scope.lstHearingType[0];
                    $scope.m.hearingTypeId = $scope.m.hearingType.id;
                }
                else {
                    for (var i = 0; i < $scope.lstHearingType.length; i++) {
                        var rel = $scope.lstHearingType[i];

                        if (rel.id === $scope.m.hearingTypeId) {
                            $scope.m.hearingType = rel;
                            break;
                        }
                    }
                }
        };

        $scope.lockArrangements = function () {
            if ($scope.m.hearingType && $scope.m.hearingType.lock == true || $scope.m.isView == true) {
                $("#divMedidas :input").attr("disabled", true);
                $("#divMedidasHidden :input").attr("disabled", false);
            }
            else {
                $("#divMedidas :input").attr("disabled", false);
                $("#divMedidasHidden :input").attr("disabled", true);
            }
            $scope.lockDefaultArrangements();
        };

        $scope.lockDefaultArrangements = function () {

            if ($scope.m.lstArrangementShow != undefined) {
                for (var i = 0; i < $scope.m.lstArrangementShow.length; i++) {
                    if ($scope.m.lstArrangementShow[i].isDefault == true)
                        $("#arrangement" + $scope.m.lstArrangementShow[i].id).attr("disabled", true);
                }
            }
        };

        $scope.init = function () {
  
        	var js = JSON.parse($("#hdnJsonMtng").val());
			    $scope.m = js;
			    $scope.lstHearingType = JSON.parse( $("#hdnJsonHearing").val());
			    $scope.readonlyBand =$("#hdnreadonlyBand").val();

            $scope.fillFormat($scope.m);
            $scope.fillSelSupervisor();
            $scope.fillSelHearingType();
            $scope.lockArrangements();
            $scope.disableView($scope.m.disableAll);
            $scope.init2();

            $scope.locationInit();

        };

        $scope.chgLblTerms = function () {
            if ($scope.m.arrType == 2)
                $scope.lblTerms = $sce.trustAsHtml("Plazo");
            else if ($scope.m.arrType == 1)
                $scope.lblTerms = $sce.trustAsHtml("Plazo de investigaci&oacute;n");
        };

        $timeout(function () {
            $scope.init();
        }, 0);

        $scope.returnUrlId = function () {
            var urlRet = $('#urlRet').attr("value");
            window.goToUrlMvcUrl(urlRet);
        };



        //////////
        $scope.c = {};
        $scope.listElection = [];
        $scope.c.federal = 0;
        $scope.listCrime = [];
        $scope.optionsCrime = [];
        $scope.listMsgError = [];


        $scope.init2 = function () {
            //$(".chosen-select").chosen();
            //$(".chosen-single span:nth-child(1)").text("Seleccione una opción");
            console.log("before");

            console.log("$scope.m.listCrime"+$("#hdnJsonlistCrime").val());
            $scope.listCrime = JSON.parse($("#hdnJsonlistCrime").val());
            console.log("$scope.m.optionsCrime"+$("#hdnJsonOptionsCrime").val());
            $scope.optionsCrime = JSON.parse($("#hdnJsonOptionsCrime").val());
            console.log("$scope.m.listElection"+$("#hdnJsonlistElection").val());
            $scope.listElection = JSON.parse($("#hdnJsonlistElection").val());

            if ($scope.listCrime == undefined) {
                $scope.listCrime = [];
            }
            if ($scope.listElection === undefined || $scope.listElection.length <= 0)
                return;

            if ($scope.c.federalId === undefined) {
                $scope.c.federal = $scope.listElection[0];
                $scope.c.federalId = $scope.c.federal.id;
            }
            $scope.cleanArray();

        };


        @*$timeout(function () {
            $scope.init2();
        }, 0);*@

        $scope.validateCrime = function () {
            valid = true;
            var strArticle = $scope.c.article + "";
            if ($scope.c.crime == undefined) {
                $scope.listMsgError.push("Debe seleccionar un delito");
                valid = false;
            }

            if ($scope.c.article == undefined || (strArticle.length > 100 || strArticle.length < 1)) {
                $scope.listMsgError.push("La longitud del artículo debe ser entre 1 y 100 caracteres");
                valid = false;
            }
            if ($scope.c.comment != undefined && $scope.c.comment.length > 255) {
                $scope.listMsgError.push("La longitud del comentario debe ser entre 1 y 255 caracteres");
                valid = false;
            }
            return valid;
        }
        $scope.addCrime = function () {
            if ($scope.validateCrime() == false) {
                return false;
            }

            $scope.listMsgError = [];

            var a = {};
            a.federal = {};
            a.crime = {};
            a.crime = $scope.c.crime;
            a.comment = $scope.c.comment;
            a.federal.id = $scope.c.federal.id;
            a.federal.name = $scope.c.federal.name;
            a.article = $scope.c.article;
            $scope.listCrime.push(a);
            $scope.c.federal = $scope.listElection[0];
            $scope.c.comment = undefined;
            $scope.c.article = undefined;
            $scope.cleanArray();

        };

        $scope.deleteCrime = function (index) {
            $scope.listCrime.splice(index, 1);
            $scope.cleanArray();

        };

        $scope.cleanArray = function () {
            var abc = $scope.listCrime;
            $scope.crimeString = JSON.stringify(abc);

            /*for(var item in $scope.listSchedule){
             delete item[$$hashKey];
             } */
        }

        $scope.valAddedCrime = function () {
            $scope.listMsgError = [];
            valid = true;
            if (!$scope.listCrime || !($scope.listCrime.length > 0)) {
                $scope.listMsgError.push("Debe agregar al menos un delito");
                valid = false;
            }
            return valid;
        };

        $rootScope.$on('valAddCrime', function (event,scope,prop) {
            scope[prop]=$scope.valAddedCrime();
        });
        /////////




        /////Address
        $scope.zipCode = "";
    $scope.Reference = 0;
    $scope.listState=[];
    $scope.state = {};
    $scope.listMunicipality=[];
    $scope.municipality = {};
    $scope.listLocation=[];
    $scope.m.location = {};

    $scope.ZipCodeSearch = function(){
    	$scope.msgZipCode = undefined;
    	if($scope.listState==undefined || $scope.listState.length<=0){
    	var asx = MeetingService.findAllStates();
    	console.log ("axs o estados string"+asx);
		    $scope.listState = JSON.parse(asx);
    	}
		    console.log("ZipCodeSearch"+$scope.zipCode);
    		if(($scope.zipCode+"").length>=5){
    		console.log(MeetingService.findAddressByCp($scope.zipCode));
    			var jsonStrngData = MeetingService.findAddressByCp($scope.zipCode);
    			if(jsonStrngData==""){
    				$scope.msgZipCode = "El código postal "+$scope.zipCode+" no existe.";
    			}
    			else{
    				var domicilioData = JSON.parse(jsonStrngData);
    				$scope.state = $scope.itemListById(domicilioData.StateId ,  $scope.listState);
    				console.log("estados "+$scope.state	);
    				$scope.listMunicipality = domicilioData.Municipios;
    				console.log("listMunicipality name "+ $scope.listMunicipality[1].Name+"    $scope.listMunicipality[1]--"+$scope.listMunicipality[1].Id);
    				$scope.municipality = $scope.itemListById(domicilioData.MunicipalityId , $scope.listMunicipality);
    				$scope.listLocation = domicilioData.Locaciones;
    				console.log("Locaciones name "+ $scope.listLocation[1].Name+"    id--"+$scope.listLocation[1].Id);
    			}
    		}
    	};

    	$scope.locationInit = function(){
		    console.log("scope.hdnJsonAddress"+$("#hdnJsonAddress").val());
	        var adrs =$("#hdnJsonAddress").val();
	        $scope.m.location = {};
	        console.log("adrs"+adrs);

	       	if(adrs != undefined && adrs != "" ){
	        var adressDto = JSON.parse(adrs);
	        console.log("adressDto"+adressDto);
	        console.log("scope m ->"+$scope.m);
	        $scope.m.idAddres = adressDto.id;
	        $scope.m.innNum = adressDto.innNum;
	        $scope.m.outNum = adressDto.outNum;
	        $scope.m.street = adressDto.street;
	        $scope.zipCode = adressDto.zipCode;
	        $scope.m.location = {};
	        $scope.m.location.id = adressDto.locationId;

	        $("#innNum").val($scope.m.innNum);
	        $("#street").val($scope.m.street);
	        $("#outNum").val($scope.m.outNum);



	        console.log("scope.idAddres"+$scope.m.idAddres);
	        console.log("scope.innNum"+$scope.m.innNum);
	        console.log("scope.outNum"+$scope.m.outNum);
	        console.log("scope.street"+$scope.m.street);
	        console.log("scope.zipCode"+$scope.zipCode);
	        console.log("scope.location.id"+$scope.m.location.id);
	        }

	   		var asx = MeetingService.findAllStates();
			$scope.listState = JSON.parse(asx);
	    	
			if($scope.m.location.id!=undefined &&  $scope.m.location.id!=null){
				var jsonStrngData = MeetingService.findAddressByLocation($scope.m.location.id);
				if(jsonStrngData==""){
					$scope.msgZipCode = "El código postal "+$scope.zipCode+" no existe.";
				}
				else{
					var domicilioData = JSON.parse(jsonStrngData);
					$scope.state = $scope.itemListById(domicilioData.StateId ,  $scope.listState);
					$scope.listMunicipality = domicilioData.Municipios;
					console.log("listMunicipality name "+ $scope.listMunicipality[1].Name+"    $scope.listMunicipality[1]--"+$scope.listMunicipality[1].Id);
					$scope.municipality = $scope.itemListById(domicilioData.MunicipalityId , $scope.listMunicipality);
					$scope.listLocation = domicilioData.Locaciones;
					$scope.location = $scope.itemListById($scope.m.location.id , $scope.listLocation);
					console.log("Locaciones name "+ $scope.listLocation[1].Name+"    id--"+$scope.listLocation[1].Id);
					$scope.zipCode = domicilioData.zipCode;
				}
			}
    	};

	

		$scope.itemListById = function(idObj, list){
    console.log("idObj="+idObj);
    	if(idObj!=undefined&&idObj!=null){
		    for(x=0;x<list.length;x++){
		    	if(list[x].Id==idObj){
		    		return list[x];
		    		break;
		    	}
		    }
		}
		return undefined;
	};


        /////Address End




    }
)
;
</script>
<script>
 function regresar(idRef){
 		console.log("regresar del edit-"+idRef);
		window.location.replace('hybrid:Supervision/HearingFormatList?idCase='+idRef);
    }
    function TryParseInt(str,defaultValue) {
     var retValue = defaultValue;
     if(str !== null) {
         if(str.length > 0) {
             if (!isNaN(str)) {
                 retValue = parseInt(str);
             }
         }
     }
     return retValue;
}
</script>
<script type="text/javascript">

        jQuery(function ($) {
            $('#id-disable-check').on('click', function () {
                var inp = $('#form-input-readonly').get(0);
                if (inp.hasAttribute('disabled')) {
                    inp.setAttribute('readonly', 'true');
                    inp.removeAttribute('disabled');
                    inp.value = "This text field is readonly!";
                }
                else {
                    inp.setAttribute('disabled', 'disabled');
                    inp.removeAttribute('readonly');
                    inp.value = "This text field is disabled!";
                }
            });

            $('.date-picker').datepicker({autoclose: true}).next().on(ace.click_event, function () {
                $(this).prev().focus();
            });
            $('input[name=date-range-picker]').daterangepicker().prev().on(ace.click_event, function () {
                $(this).next().focus();
            });

            $('#modal-form input[type=file]').ace_file_input({
                style: 'well',
                btn_choose: 'Drop files here or click to choose',
                btn_change: null,
                no_icon: 'icon-cloud-upload',
                droppable: true,
                thumbnail: 'large'
            })

            $('#modal-form').on('shown.bs.modal', function () {
                $(this).find('.chosen-container').each(function () {
                    $(this).find('a:first-child').css('width', '210px');
                    $(this).find('.chosen-drop').css('width', '210px');
                    $(this).find('.chosen-search input').css('width', '200px');
                });
            })

            $('#initTimeStr').timepicker({
                minuteStep: 1,
                showSeconds: true,
                showMeridian: false
            }).next().on(ace.click_event, function () {
                $(this).prev().focus();
            });

            $('#endTimeStr').timepicker({
                minuteStep: 1,
                showSeconds: true,
                showMeridian: false,
                timeFormat: 'hh:mm:ss tt',
                ampm: false
            }).next().on(ace.click_event, function () {
                $(this).prev().focus();
            });

            $('#linkageTimeStr').timepicker({
                minuteStep: 1,
                showSeconds: true,
                showMeridian: false
            }).next().on(ace.click_event, function () {
                $(this).prev().focus();
            });

            $('#umecaTimeStr').timepicker({
                minuteStep: 1,
                showSeconds: true,
                showMeridian: false
            }).next().on(ace.click_event, function () {
                $(this).prev().focus();
            });
        });
    </script>







<h2 class="element-center"><i class="icon-archive"></i>&nbsp;&nbsp;Formato de audiencia</h2>

<form id="FormFormatId" name="FormFormatId" class="form-horizontal"
      role="form" method="post">
    <br/>



    <div class="container body-content" ng-app="umecaMobile"  ng-controller="hearingFormatController"
         ng-init='m.rdHasContacts = 1;' style="padding:50px;">
         <input id="hdnJsonMtng" type="hidden" value="@Model.model" name="jsonString" />
         <input id="hdnJsonHearing" type="hidden" value="@Model.lstHearingType" />
         <input id="hdnJsonlistCrime" type="hidden" value="@Model.listCrime" />
         <input id="hdnJsonOptionsCrime" type="hidden" value="@Model.optionsCrime" />
         <input id="hdnJsonlistElection" type="hidden" value="@Model.listElection"/>
         <input id="hdnreadonlyBand" type="hidden" value="@Model.readonlyBand"/>
         <input id="hdnhasPrevHF" type="hidden" value="@Model.hasPrevHF"/>
         <input id="hdnJsonAddress" type="hidden" value="@Model.address"/>


         <!-- TERMINATE CREDENTIALS -->
    <script>
var askCloseCredentials  = {};

askCloseCredentials.show = function (){
	var dlgMsgBox = $('#askCloseCredentialsBoxDlgId');
	dlgMsgBox.show();
askVerificationTerminate.hide();
window.scrollTo(0, 230);
};

askCloseCredentials.hide = function (){
	var dlgMsgBox = $('#askCloseCredentialsBoxDlgId');
	dlgMsgBox.hide();
};
    	</script>
<div class="modal-dialog" style="display:none; width:60%; position: relative;top: 5%;left: 50%;margin: 0 0 0 -30%;" id="askCloseCredentialsBoxDlgId" >
        <div class="modal-content" style="z-index: 1000;">
            <div class="modal-header">
                <div class="alert alert-info">
                    <button id="askCloseCredentialsBoxDlgXclose" type="button" class="close" onclick="javascript:askCloseCredentials.hide();">×</button>
                    <h4 class="modal-title element-center">Cerrar caso</h4>
                    <br />Se cerrará el caso por que no existe una vinculación a proceso. Debe ingresar sus credenciales para
                    confimar esta acción.
                </div>
            </div>
            <div class="modal-body">
                        <div class="row">
                            <label for="confirmComment">Comentario</label>
                            <br/>
                            <textarea class="input-xxlarge form-control limited" id="confirmComment"
                                      name="confirmComment"
                                      ng-model="m.confirmComment" maxlength="980" data-val="true"
                                      data-val-required="Comenatario(s) adicionales es un campo requerido">
                                </textarea>
                            <br/>
                            <span class="field-validation-valid" data-valmsg-for="confirmComment"
                                  data-valmsg-replace="true"></span>
                        </div>

                        <div class="row" ng-show="m.confirmComment.length>0">
                            <label for="credPass">Contrase&ntilde;a</label>
                            <br/>
                            <input id="credPass" ng-model="m.credPass" name="credPass"
                                   type="password" data-val="true" class="input-xlarge"
                                   data-val-required="Contrase&ntilde;a es un campo requerido"/>
                            <br/>
                            <span class="field-validation-valid" data-valmsg-for="credPass"
                                  data-valmsg-replace="true"></span>
                        </div>
            </div>
            <div class="modal-footer">
                <button id="MessageBoxDlgYes" type="button" class="btn btn-default btn-primary" ng-click="saveHFClose();" >Si</button>
                <button id="MessageBoxDlgNo" type="button" class="btn btn-default" onclick="javascript:askCloseCredentials.hide();" >No</button>
            </div>
        </div>
        <div class="blocker" style="z-index:999;">
		    <div>
		        Cargando...<img src="content/images/ajax_loader.gif" alt="no content detected" />
		    </div>
		</div>
    </div>
    <!-- TERMINATE CREDENTIALS END -->


         <!--
        <div class="blocker" ng-show="WaitFor==true">
            <div>
                Cargando...<img src="<c:url value='/assets/content/images/ajax_loader.gif' />" alt=""/>
            </div>
        </div>-->

        <!--<input type="hidden" id="url3"
               value="<c:url value='/supervisor/hearingFormat/searchArrangementsByType.json'/>"/>
        <input type="hidden" id="urlRet"
               value="<c:url value='/supervisor/hearingFormat/indexFormats.html'/>?id={{m.idCase}}&returnId={{returnId}}"/>
               -->
        <input type="hidden" id="idCase" name="idCase" value="@Model.IdCase"/>
        <input type="hidden" name="lstArrangement" value="{{m.lstArrangementShow}}"/>
        <!--<input type="hidden" name="lstContactData" value="{{m.lstContactData}}"/>-->
        <input type="hidden" ng-model="m.isFinished" name="isFinished" ng-update-hidden />
        <input type="hidden" name="idFormat" value="{{m.idFormat}}"/>
        <input type="hidden" id="umecaSupervisorId" name="umecaSupervisorId" value="{{m.umecaSupervisor.id}}"/>


        <div class="row">

            <div class="col-xs-6">
                <h3 class="header smaller lighter blue">
                    <small>Nombre del supervisor:</small>
                    &nbsp;&nbsp;{{m.userName}}
                </h3>
            </div>

            <div class="col-xs-6 element-right">
                <div>
                            <span class="btn btn-default btn-sm" onclick="regresar(@Model.IdCase);" >
                                  <!--ng-click="returnUrl('<c:url value='/supervisor/hearingFormat/indexFormats.html'/>'+'?id='+m.idCase)">-->
                                Regresar
                            </span>
                            <span class="btn btn-default btn-primary btn-sm notAviable" ng-disabled="WaitFor==true"  ng-click="submitPartiaSaveHF();">
                                  <!--ng-click="submitPartiaSaveHF('#FormFormatId','<c:url value='/supervisor/hearingFormat/doUpsert.json'/>');">-->
                                Guardar
                            </span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12">
                <div ng-show="MsgError&&MsgError!=''" ng-clean-error msg="MsgError"
                     class="umeca-toast-error element-center">
                    <p ng-bind-html="MsgError"></p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div ng-show="MsgSuccess&&MsgSuccess!=''" ng-clean-error msg="MsgSuccess"
                     class="umeca-toast-success element-center">
                    <p ng-bind-html="MsgSuccess"></p>
                </div>
            </div>
            <div class="col-xs-12">
                <div ng-show="MsgSuccess&&MsgSuccess!=''" class="alert alert-success element-center">
                    <p ng-bind-html="MsgSuccess"></p>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="widget-box">
                <div class="widget-header">Datos generales</div>
                <div class="widget-body">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <br/>

                            <div class="widget-box" id="divAudiencia">
                                <div class="widget-header"> Audiencia</div>
                                <div class="widget-body">
                                    <div class="row">
                                        <div class="col-xs-10 col-xs-offset-1">
                                            <br/>
                                            <c:if test="${hasPrevHF ==true}">
                                                <input type="hidden" id="hearingTypeId" name="hearingTypeId"
                                                       value="{{m.hearingType.id}}"/>

                                                <div class="row">
                                                    <div class="col-xs-4">
                                                        <label>Tipo de audiencia</label><label class="info-example">(Es muy importante realizar un correcto registro del tipo de audiencia ya que afectar&aacute; el plan de monitoreo)</label>
                                                        <br/>
                                                        <select class="form-control element-center"
                                                                ng-model="m.hearingType"
                                                                ng-options="e.description for e in lstHearingType"
                                                                @*ng-init='lstHearingType = ${lstHearingType};'*@
                                                                ng-change="lockArrangements(); m.hearingTypeId = m.hearingType.id;" ></select>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <label>&iquest;Se present&oacute; el imputado a la
                                                            audiencia?</label>
                     <span class="field-validation-valid" data-valmsg-for="imputedPresence"
                           data-valmsg-replace="true"></span>

                                                        <div class="radio">
                                                            <label>
                                                                <input name="imputedPresence" class="ace" type="radio"
                                                                       value="1"
                                                                       ng-model="m.imputedPresence"
                                                                       ng-checked="m.imputedPresence==1" data-val="true"
                                                                       data-val-required="Debe seleccionar un valor">
                                                                <span class="lbl">&nbsp;&nbsp;Si</span>
                                                            </label>
                                                            <br/>
                                                            <label>
                                                                <input name="imputedPresence" class="ace" type="radio"
                                                                       value="2"
                                                                       ng-model="m.imputedPresence"
                                                                       ng-checked="m.imputedPresence==2">
                                                                <span class="lbl">&nbsp;&nbsp;No</span>
                                                            </label>

                                                        </div>
                                                    </div>
                                                    <div class="col-xs-4">
                                                        <label>Resultado de la audiencia</label>
                                                        <br/>
            <textarea class="input-xxlarge form-control limited" name="hearingResult"
                      ng-model="m.hearingResult"
                      maxlength="980" data-val="true"
                      data-val-required="Resultado de la audiencia es un campo requerido">
            </textarea>
        <span class="field-validation-valid" data-valmsg-for="hearingResult"
              data-valmsg-replace="true"></span>
                                                    </div>
                                                </div>

                                                <div class="row" ng-show="m.hearingType.specification==true">
                                                    <div class="col-xs-4">
                                                        <label>Especifique tipo de audiencia</label>
                                                        <br/>
            <textarea class="input-xxlarge form-control limited" name="hearingTypeSpecification"
                      ng-model="m.hearingTypeSpecification"
                      maxlength="980" data-val="true"
                      data-val-required="Especificaci&oacute;n de tipo de audiencia es un campo requerido">
            </textarea>
        <span class="field-validation-valid" data-valmsg-for="hearingTypeSpecification"
              data-valmsg-replace="true"></span>
                                                    </div>
                                                </div>
                                                <br/>
                                            </c:if>
                                            <div class="row">

                                                <div class="col-xs-4">
                                                    <label for="idFolder">Carpeta de investigaci&oacute;n</label>
                                                    <br/>
                                                    <input id="idFolder" ng-model="m.idFolder" name="idFolder"
                                                           type="text" class="input-xxlarge" data-val="true"
                                                           ng-disabled="m.canEdit==false"
                                                           data-val-length-max="30"
                                                           data-val-length="Debe tener m&aacute;ximo 30 caracteres"
                                                           data-val-required="Carpeta de investigaci&oacute;n es un campo requerido"/>
                                                    <br/>
                        <span class="field-validation-valid" data-valmsg-for="idFolder"
                              data-valmsg-replace="true"></span>
                                                </div>

                                                <div class="col-xs-4">
                                                    <label for="idJudicial">Carpeta judicial</label>
                                                    <br/>
                                                    <input id="idJudicial" ng-model="m.idJudicial"
                                                           name="idJudicial" type="text"
                                                           class="input-xxlarge" data-val="true"
                                                           ng-disabled="m.canEdit==false"
                                                           data-val-length-max="15"
                                                           data-val-length="Debe tener m&aacute;ximo 15 caracteres"
                                                           data-val-required="Carpeta judicial es un campo requerido"/>
                                                    <br/>
                        <span class="field-validation-valid" data-valmsg-for="idJudicial"
                              data-valmsg-replace="true"></span>
                                                </div>

                                                <div class="col-xs-4">
                                                    <label for="room">Distrito judicial</label>
                                                    <br/>
                                                    <input id="room" ng-model="m.district" name="room" type="text"
                                                           class="input-xxlarge" data-val="true"
                                                           data-val-required="Distrito judicial es un campo requerido"/>
                                                    <br/>
                                        <span class="field-validation-valid" data-valmsg-for="room"
                                              data-valmsg-replace="true"></span>
                                                </div>
                                            </div>
                                            <br/>
                                            <div class="row">
                                                <div class="col-xs-4">

                                                    <label for="appointmentDateStr">Fecha de audiencia:</label>

                                                    <div class="row">
                                                        <div class="col-xs-8 col-sm-11">
                                                            <div class="input-group">
                                                                <input id="appointmentDateStr" name="appointmentDateStr"
                                                                       ng-model="m.appointmentDate"
                                                                       class="form-control date-picker"
                                                                       id="id-date-picker-1" type="text"
                                                                       data-date-format="yyyy/mm/dd" data-val="true"
                                                                       readonly
                                                                       data-val-required="Fecha de audiencia es un campo requerido"/>
                                    <span class="input-group-addon">
                                        <i class="icon-calendar bigger-110"></i>
                                    </span>
                                                            </div>
                                <span class="field-validation-valid" data-valmsg-for="appointmentDateStr"
                                      data-valmsg-replace="true"></span>
                                                        </div>
                                                    </div>

                                                </div>

                                                <div class="col-xs-4">
                                                    <label for="initTimeStr">Hora inicio audiencia</label>

                                                    <div class="input-group bootstrap-timepicker">
                                                        <input id="initTimeStr" name="initTimeStr" ng-model="m.initTime"
                                                               ng-change="validateInitEnd();" readonly
                                                               type="text" class="form-control umeca-time-picker"
                                                               data-val="true"
                                                               data-val-required="Hora de inicio es un campo requerido"/>
                                                        <span class="input-group-addon"><i
                                                                class="icon-time bigger-110"></i></span>
                                                        <br/>
                                                    </div>
                        <span class="field-validation-valid" data-valmsg-for="initTimeStr"
                              data-valmsg-replace="true"></span>
                                                </div>

                                                <div class="col-xs-4" ng-show="false">
                                                    <label for="endTimeStr">Hora t&eacute;rmino audiencia</label>

                                                    <div class="input-group bootstrap-timepicker">
                                                        <input id="endTimeStr" name="endTimeStr"
                                                               ng-change="validateInitEnd();" ng-model="m.endTime"
                                                               readonly type="text"
                                                               class="form-control umeca-time-picker"
                                                               min-time="6:00am"
                                                               data-val="true"
                                                               data-val-required="Hora de t&eacute;rmino es un campo requerido"/>
                                                        <span class="input-group-addon"><i
                                                                class="icon-time bigger-110"></i></span>
                                                        <br/>
                                                    </div>
                        <span class="field-validation-valid" data-valmsg-for="endTimeStr"
                              data-valmsg-replace="true">{{m.errTime}}</span>
                                                    <span ng-class='m.errTime&&m.errTime!="" ? "field-validation-error": "field-validation-valid"'>{{m.errTime}}</span>
                                                </div>
                                            </div>
                                            <br/>

                                            <div class="row">

                                                <div class="col-xs-4">
                                                    <label for="judgeName">Juez de control</label>
                                                    <br/>
                                                    <input id="judgeName" ng-model="m.judgeName" name="judgeName"
                                                           type="text" class="input-xxlarge"
                                                           data-val="true"
                                                           data-val-required="Juez de control es un campo requerido"/>
                                                    <br/>
            <span class="field-validation-valid" data-valmsg-for="judgeName"
                  data-valmsg-replace="true"></span>
                                                </div>


                                                <div class="col-xs-4">

                                                    <label for="mpName">Ministerio P&uacute;blico</label>
                                                    <br/>
                                                    <input id="mpName" ng-model="m.mpName" name="mpName" type="text"
                                                           class="input-xxlarge"
                                                           data-val="true"
                                                           data-val-required="Ministerio P&uacute;blico es un campo requerido"/>
                                                    <br/>
            <span class="field-validation-valid" data-valmsg-for="mpName"
                  data-valmsg-replace="true"></span>
                                                </div>

                                                <div class="col-xs-4">

                                                    <label for="defenderName">Defensor</label>
                                                    <br/>
                                                    <input id="defenderName" ng-model="m.defenderName"
                                                           name="defenderName"
                                                           type="text"
                                                           class="input-xxlarge"
                                                           data-val="true"
                                                           data-val-required="Defensor es un campo requerido"/>
                                                    <br/>
            <span class="field-validation-valid" data-valmsg-for="defenderName"
                  data-valmsg-replace="true"></span>
                                                </div>

                                            </div>
                                            <br/>
                                        </div>
                                    </div>

                                </div>


                            </div>

                            <br/>

                            <div class="widget-box" id="divImputado">
                                <div class="widget-header">Datos del imputado</div>
                                <div class="widget-body">
                                    <div class="row">
                                        <div class="col-xs-10 col-xs-offset-1">
                                            <br/>

                                            <div class="row">
                                                <div class="col-xs-4">

                                                    <label for="imputedName">Nombre(s)</label>
                                                    <br/>
                                                    <input id="imputedName" ng-model="m.imputedName" name="imputedName"
                                                           type="text"
                                                           class="input-xxlarge"
                                                           data-val="true" ng-disabled="m.canEdit==false"
                                                           data-val-required="Nombre es un campo requerido"/>
                                                    <br/>
            <span class="field-validation-valid" data-valmsg-for="imputedName"
                  data-valmsg-replace="true"></span>
                                                </div>

                                                <div class="col-xs-4">

                                                    <label for="imputedFLastName">Apellido paterno</label>
                                                    <br/>
                                                    <input id="imputedFLastName" ng-model="m.imputedFLastName"
                                                           name="imputedFLastName" type="text"
                                                           class="input-xxlarge" data-val="true"
                                                           ng-disabled="m.canEdit==false"
                                                           data-val-required="Apellido paterno es un campo requerido"/>
                                                    <br/>
            <span class="field-validation-valid" data-valmsg-for="imputedFLastName"
                  data-valmsg-replace="true"></span>

                                                </div>

                                                <div class="col-xs-4">

                                                    <label for="imputedSLastName">Apellido materno</label>
                                                    <br/>
                                                    <input id="imputedSLastName" ng-model="m.imputedSLastName"
                                                           name="imputedSLastName" type="text"
                                                           class="input-xxlarge" data-val="true"
                                                           ng-disabled="m.canEdit==false"
                                                           data-val-required="Apellido materno es un campo requerido"/>
                                                    <br/>
            <span class="field-validation-valid" data-valmsg-for="imputedSLastName"
                  data-valmsg-replace="true"></span>

                                                </div>
                                            </div>


                                            <div class="row">
                                                <br/>

                                                <div class="col-xs-4">

                                                    <label for="imputedBirthDateStr">Fecha de nacimiento</label>

                                                    <div class="row">
                                                        <div class="col-xs-8 col-sm-11">
                                                            <div class="input-group">
                                                                <input class="form-control date-picker"
                                                                       id="imputedBirthDateStr"
                                                                       name="imputedBirthDateStr" type="text"
                                                                       data-date-format="yyyy/mm/dd"
                                                                       ng-disabled="m.canEdit==false"
                                                                       readonly ng-change="calcAge();"
                                                                       ng-model="m.impBthDay" data-val="true"
                                                                       data-val-required="Fecha de nacimiento es un campo requerido"/>
                                                <span class="input-group-addon">
                                                    <i class="icon-calendar bigger-110"></i>
                                                </span>
                                                            </div>
                                <span class="field-validation-valid" data-valmsg-for="imputedBirthDateStr"
                                      data-valmsg-replace="true"></span>
                                                        </div>
                                                    </div>

                                                </div>

                                                <div class="col-xs-4">

                                                    <label for="imputedAge">Edad</label>
                                                    <br/>
                                                    <input id="imputedAge" name="imputedAge" type="text"
                                                           class="input-xxlarge" readonly
                                                           ng-model="m.impAge"/>
                                                    <br/>
                                                    <span ng-class='m.errAge&&m.errAge!="" ? "field-validation-error" : "input-validation-valid"'>{{m.errAge}}</span>

                                                </div>

                                                <div class="col-xs-4">

                                                    <label for="imputedTel">Tel&eacute;fono(s)</label>
                                                    <br/>
                                                    <input id="imputedTel" ng-model="m.imputedTel" name="imputedTel"
                                                           type="text"
                                                           class="input-xxlarge"
                                                           data-val="true" ng-disabled="m.canEdit==false"
                                                           data-val-required="Tel&eacute;fono(s) es un campo requerido"/>
                                                    <br/>
            <span class="field-validation-valid" data-valmsg-for="imputedTel"
                  data-valmsg-replace="true"></span>

                                                </div>





                                                <!--componente adress by cp-->
                <div class="row">
				  <div class="col-xs-5">
				    <label for="zipCode">C&oacute;digo postal:</label>
				    <input type="text" id="zipCode" name="zipCode" class="input-xxlarge" ng-model="zipCode"
				    data-val="true" data-val-required="El c&oacute;digo postal es un campo requerido"
				    placeholder="Escriba su C.P. para buscar.."
				    data-val-length-max="6" data-val-length-min="1"
				    data-val-length="Debe tener al menos 1 y m&aacute;ximo 6 caracteres."
				    ng-change="m.location.ZipCode = zipCode;ZipCodeSearch();" />
				    <br>
				    <span class="field-validation-valid" data-valmsg-for="zipCode" data-valmsg-replace="true"></span>
				  </div>
				  <div class="col-xs-7">
				    <br/>
				    <div ng-show="msgZipCode" class="alert-danger element-center">
				      {{msgZipCode}}
				    </div>
				     
				  </div>
				</div>

				<div class="row">
				  <div class="col-xs-6">
				    <label>Estado:</label>
				    <select class="form-control element-center" ng-model="state" 	
				    ng-options="e.Name for e in listState" ></select><br/>
				  </div>
				  <div class="col-xs-6">
				    <label>Municipio:</label>
				    <select class="form-control element-center" ng-model="municipality"
				    ng-options="e.Name for e in listMunicipality" ng-init='listMunicipaliti = ""'
				    ng-change="municipalityId = municipality.id;"></select><br/>
				  </div>
				</div>
				<div class="row">
				  <div class="col-xs-12">
				    <label>Localidad/Colonia:</label>
				    <br/>
				    <select class="form-control" ng-model="location"
				    ng-options="e.Name for e in listLocation" ng-init='listLocation = ""'
				    ng-change="m.LocationId = location['Id'];m.location.id = location['Id'];"></select>
				  </div>
				</div>
				<br/>
				<div class="row">
					  	<div class="col-xs-6">
						    Calle <br/>
						    <input class="form-control" data-val="true" data-val-required="La calle es un campo requerido"
						    data-val-length-max="100" data-val-length-min="1" 
						    data-val-length="Debe tener al menos 1 y m&aacute;ximo 100 caracteres."
						    type="text" value="" ng-model="m.street" name="m.street" id="street">
						    <span class="field-validation-valid" data-valmsg-for="m.street"
						    data-valmsg-replace="true"></span>
						  </div>
						  <div class="col-xs-3">
						    No Ext <br/>
						    <input class="form-control" data-val="true"
						    data-val-length="Debe tener al menos 1 y m&aacute;ximo 10 caracteres"
						    data-val-length-max="10" data-val-length-min="1"
						    data-val-required="El n&uacute;mero exterior es un campo requerido"
						    type="text" ng-model="m.outNum"
						    id="outNum"
						    name="m.outNum">
						    <span class="field-validation-valid" data-valmsg-for="m.outNum"
						    data-valmsg-replace="true"></span>
						  </div>
						  <div class="col-xs-3">
						    No Int <br/>
						    <input class="with-100" data-val="true"
						    data-val-length="Debe tener al menos 1 y m&aacute;ximo 10 caracteres"
						    data-val-length-max="10" data-val-length-min="1"
						    type="text" ng-model="m.innNum"
						    id="innNum"
						    name="m.innNum">
						    <span class="field-validation-valid" data-valmsg-for="m.innNum"
						    data-valmsg-replace="true"></span>
						  </div>
				</div>
				<br/>
				<!--END componente adress by cp-->


                                            </div>

                                            <br/>

                                            <div class="row">
                                             <!--   <% include file="/WEB-INF/jsp/address/index.jsp" %> -->
                                            </div>

                                            <br/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <br/>

                                <div class="col-xs-12" id="divDelitos">
                                    <div class="widget-box">
                                        <div class="widget-header">Delitos</div>
                                        <div class="widget-body">
                                            <div class="row">
                                                <div class="col-xs-10 col-xs-offset-1"
                                                     @*ng-init="readonlyBand = ${readonlyBand == null ? false: readonlyBand};" *@ >
                                                    <br/>
                                                <!--    <% include file="/WEB-INF/jsp/reviewer/meeting/shared/crime.jsp" %> -->
                                                <!---->
<style>
    .chosen-container-single .chosen-search:after {
        content: "" !important;
    }
</style>
<div class="row element-center" >
    <div class="row element-left" >
        <b>Delitos:</b>
    </div>
    <input type="hidden" ng-update-hidden @*ng-init='listCrime = ${(listCrime == null) ? '[]': listCrime};'*@>
    <input type="hidden" ng-update-hidden ng-model="crimeString" name='listCrime'>
    <div class="col-xs-12">

        <div class="row" id="crimeAdder" ng-show="readonlyBand == false">
    <div class="col-xs-5 element-center">
       Delito<br/><br/>
        <select class="width-95 element-center" ng-model="c.crime" 
                ng-options="e.name for e in optionsCrime"
                ng-change="c.crimeId = c.crime.id"
                data-placeholder="Seleccione una opción" id="ms"
                @*multiple="multiple" id="ms"*@
                ></select>
    </div>
    <div class="col-xs-1 element-center">
       Art&iacute;culo<br/><br/>
            <input type="text" class="form-control" ng-model="c.article"/>
    </div>
    <div class="col-xs-2 element-center">
        Federal<br/> <label class="info-example">(Asociado con el local)</label> <br/>
        <select class="form-control element-center" ng-model="c.federal"
                ng-options="e.name for e in listElection"
                ng-change="c.federalId = c.federal.id"
                @*ng-init='listElection = ${listElection};'*@
                ></select>
    </div>
     <div class="col-xs-3">
         Observaciones<br/><br/>
        <textarea class="width-100" ng-model="c.comment"></textarea>
     </div>
    <div class="col-xs-1 element-center">
        Acciones<br/><br/><div class="space-5"></div>
        <i class="icon-plus-sign orange" style="cursor:pointer;" ng-click="addCrime()"></i>
    </div>
    </div>
        <div class="row" >
        <div class="hr hr-6"></div>
        </div>
        <div ng-show="listMsgError.length > 0" class="alert alert-danger element-center error-font">
            <div  ng-repeat ="msg in listMsgError">
                {{msg}}
                <br/>
            </div>
        </div>
        <div class="col-xs-12" ng-show ="listCrime.length > 0">
         <div class="row center">
             <div class="col-xs-5">
                 <h5 class="smaller lighter blue">Delito</h5>
                 <div class="hr hr-2"></div>
             </div>
             <div class="col-xs-1">
                 <h5 class="smaller lighter blue">Art&iacute;culo</h5>
                 <div class="hr hr-2"></div>
             </div>
             <div class="col-xs-2">
                 <h5 class="smaller lighter blue">Federal</h5>
                 <div class="hr hr-2"></div>
             </div>
             <div class="col-xs-3">
                 <h5 class="smaller lighter blue">Observaciones</h5>
                 <div class="hr hr-2"></div>
             </div>
             <div class="col-xs-1" ng-show="readonlyBand == false">
                 <h5 class="smaller lighter blue">Acciones</h5>
                 <div class="hr hr-2"></div>
             </div>
         </div>
            <div class="row center" ng-repeat ="crime in listCrime">
                <div class="col-xs-5">
                    {{crime.crime.name}}
                </div>
                <div class="col-xs-1">
                     {{crime.article}}
                </div>
                <div class="col-xs-2">
                    {{crime.federal.name}}
                </div>
                <div class="col-xs-3">
                    {{crime.comment}}
                </div>
                <div class="col-xs-1" ng-show="readonlyBand == false">
                    <i class="icon-trash red" style="cursor:pointer;" ng-click="deleteCrime($index)"></i>
                </div>
            </div>
         </div>

    </div>
    <br/>
</div>
                                                <!---->
                                                    <br/>
                                                </div>
                                            </div>
                                            <br/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <br/>

                            <div class="row" id="divPreviousHearing" ng-show="m.hasPrevHF==false">
                                <div class="col-xs-12">
                                    <div class="col-xs-10">
                                        <label>&iquest;Existe el registro de una audiencia inicial?</label>
                                        <br/>
                        <span class="field-validation-valid" data-valmsg-for="previousHearing"
                              data-valmsg-replace="true"></span>

                                        <div class="radio">
                                            <label>
                                                <input name="previousHearing" class="ace" type="radio" value="1"
                                                       ng-model="m.previousHearing"
                                                       ng-checked="m.previousHearing==1" data-val="true"
                                                       data-val-required="Debe seleccionar un valor">
                                                <span class="lbl">&nbsp;&nbsp;Si</span>
                                            </label>
                                            &nbsp;&nbsp;&nbsp;&nbsp;
                                            <label>
                                                <input name="previousHearing" class="ace" type="radio" value="2"
                                                       ng-model="m.previousHearing"
                                                       ng-checked="m.previousHearing==2" data-val="true"
                                                       data-val-required="Debe seleccionar un valor">
                                                <span class="lbl">&nbsp;&nbsp;No</span>
                                            </label>

                                        </div>

                                        <br/>
                                    </div>
                                </div>
                            </div>

                            <br/>

                            <div class="row">
                                <div class="col-xs-6" id="divCtrlDet">
                                    <div class="widget-box">
                                        <div class="widget-header">Control de detenci&oacute;n</div>
                                        <div class="widget-body">
                                            <div class="row">
                                                <div class="col-xs-10 col-xs-offset-3">
                                                    <br/>
                        <span class="field-validation-valid" data-valmsg-for="controlDetention"
                              data-valmsg-replace="true"></span>

                                                    <div class="radio">
                                                        <label>
                                                            <input name="controlDetention" class="ace" type="radio"
                                                                   value="1"
                                                                   ng-model="m.ctrlDet"
                                                                   ng-checked="m.ctrlDet==1" data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;Legal</span>
                                                        </label>
                                                        <br/>
                                                        <label>
                                                            <input name="controlDetention" class="ace" type="radio"
                                                                   value="2"
                                                                   ng-model="m.ctrlDet"
                                                                   ng-checked="m.ctrlDet==2">
                                                            <span class="lbl">&nbsp;&nbsp;Ilegal</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-show="m.previousHearing==2">
                                                            <input name="controlDetention" class="ace" type="radio"
                                                                   value="3"
                                                                   ng-model="m.ctrlDet"
                                                                   ng-checked="m.ctrlDet==3">
                                                            <span class="lbl">&nbsp;&nbsp;Sin registro</span>
                                                        </label>
                                                    </div>

                                                    <br/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <c:if test="${hasPrevHF ==true}">
                                    <input type="hidden" name="impForm" value="{{m.formImp}}"/>
                                    <input type="hidden" name="imputationDateStr" value="{{m.impDate}}"/>
                                </c:if>

                                <div id="divFormImp" class="col-xs-6">
                                    <div class="widget-box">
                                        <div class="widget-header">Formulaci&oacute;n de imputaci&oacute;n</div>
                                        <div class="widget-body">
                                            <div class="row">
                                                <div class="col-xs-10 col-xs-offset-3">
                                                    <br/>

                                                    <div class="col-xs-12">
                         <span class="field-validation-valid" data-valmsg-for="impForm"
                               data-valmsg-replace="true"></span>
                                                    </div>

                                                    <div class="radio col-xs-7">
                                                        <label ng-click="chnLblFormImp(1)">
                                                            <input id="formImpYes" class="ace" name="impForm"
                                                                   type="radio" ng-model="m.formImp"
                                                                   value="1"
                                                                   ng-checked="m.formImp==1" data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;Si</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-click="chnLblFormImp(2)">
                                                            <input id="formImpNo" class="ace" name="impForm"
                                                                   type="radio" ng-model="m.formImp"
                                                                   value="2"
                                                                   ng-checked="m.formImp==2">
                                                            <span class="lbl">&nbsp;&nbsp;No</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-show="m.previousHearing==2">
                                                            <input name="impForm" class="ace" type="radio" value="3"
                                                                   ng-model="m.formImp"
                                                                   ng-checked="m.formImp==3">
                                                            <span class="lbl">&nbsp;&nbsp;Sin registro</span>
                                                        </label>
                                                    </div>
                                                    <br/>

                                                    <div class="col-xs-7" ng-show="m.formImp>0&&m.formImp<3">
                                                        <label><p ng-bind-html="m.labelImpForm"></p></label>

                                                        <div class="input-group">
                                                            <input class="form-control date-picker"
                                                                   id="imputationDateStr" name="imputationDateStr"
                                                                   ng-model="m.impDate"
                                                                   data-date-format="yyyy/mm/dd" type="text" readonly
                                                                   data-val="true"
                                                                   data-val-required="Fecha es un campo requerido">
                            <span class="input-group-addon">
                                <i class="icon-calendar bigger-110"></i>
                            </span>
                                                        </div>
                            <span class="field-validation-valid" data-valmsg-for="imputationDateStr"
                                  data-valmsg-replace="true"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <br/>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <br/>


                            <div class="row">

                                <div class="col-xs-6" id="divExt">
                                    <div class="widget-box" ng-show="m.formImp==1">
                                        <div class="widget-header">Ampliaci&oacute;n del t&eacute;rmino</div>
                                        <div class="widget-body">
                                            <div class="row">
                                                <div class="col-xs-10 col-xs-offset-3">
                                                    <br/>
                        <span class="field-validation-valid" data-valmsg-for="extension"
                              data-valmsg-replace="true"></span>

                                                    <div class="radio">
                                                        <label ng-click="chnExtDate(1);"
                                                               ng-show="(m.disableAll==true)||(m.hasPrevHF==false&&m.ext&&m.ext>0&&m.ext<3) || (m.canEdit==true&&m.hasPrevHF==false)">
                                                            <input name="extension" class="ace" type="radio" value="1"
                                                                   ng-model="m.ext"
                                                                   ng-checked="m.ext==1" data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;72 hrs</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-click="chnExtDate(2);"
                                                               ng-show="(m.disableAll==true) || (m.hasPrevHF==false&&m.ext>0&&m.ext<3) || (m.canEdit==true&&m.hasPrevHF==false)">
                                                            <input name="extension" class="ace" type="radio" value="2"
                                                                   ng-model="m.ext"
                                                                   ng-checked="m.ext==2" data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;144 hrs</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-click="chnExtDate(3);">
                                                            <input name="extension" class="ace" type="radio" value="3"
                                                                   ng-model="m.ext"
                                                                   ng-checked="m.ext==3" data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;No</span>
                                                        </label>
                                                    </div>
                                                    <br/>

                                                    <div class="col-xs-7" ng-show="m.ext>0">
                                                        <label for="extDateStr">Nueva fecha de audiencia</label>

                                                        <div class="input-group">
                                                            <input class="form-control date-picker"
                                                                   id="extDateStr" name="extDateStr"
                                                                   ng-model="m.extDate"
                                                                   data-date-format="yyyy/mm/dd" type="text" readonly
                                                                   data-val="true"
                                                                   data-val-required="Fecha es un campo requerido">
                            <span class="input-group-addon">
                                <i class="icon-calendar bigger-110"></i>
                            </span>
                                                        </div>
                            <span class="field-validation-valid" data-valmsg-for="extDateStr"
                                  data-valmsg-replace="true"></span>
                                                    </div>
                                                    <br/>
                                                </div>
                                            </div>
                                            <br/>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6" id="divVincProc">
                                    <div class="widget-box">
                                        <div class="widget-header">Vinculaci&oacute;n a proceso</div>
                                        <div class="widget-body">
                                            <div class="row">
                                                <div class="col-xs-10 col-xs-offset-3">
                                                    <br/>
                         <span class="field-validation-valid" data-valmsg-for="vincProcess"
                               data-valmsg-replace="true"></span>

                                                    <div class="radio">
                                                        <label ng-click="chngVincProcess(1)">
                                                            <input class="ace" name="vincProcess" type="radio" value="1"
                                                                   ng-model="m.vincProcess"
                                                                   ng-checked="m.vincProcess==1" data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;Si</span>
                                                        </label>
                                                        <br/>
                                                        <label>
                                                            <input class="ace" name="vincProcess" type="radio" value="2"
                                                                   ng-model="m.vincProcess"
                                                                   ng-checked="m.vincProcess==2">
                                                            <span class="lbl">&nbsp;&nbsp;No</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-show="m.previousHearing==2">
                                                            <input name="vincProcess" class="ace" type="radio" value="3"
                                                                   ng-model="m.vincProcess"
                                                                   ng-checked="m.vincProcess==3">
                                                            <span class="lbl">&nbsp;&nbsp;Sin registro</span>
                                                        </label>
                                                    </div>
                                                    <br/>

                                                    <div class="col-xs-6" ng-show="m.vincProcess==1">
                                                        <div class="row">
                                                            <br/>
                                                            <label>Sala</label>
                                                            <input type="text" name="linkageRoom"
                                                                   class="input-small" ng-model="m.linkageRoom"
                                                                   data-val="true"
                                                                   data-val-required="Sala es un campo requerido">
                                                            <br/>
                                <span class="field-validation-valid"
                                      data-valmsg-for="linkageRoom"
                                      data-valmsg-replace="true"></span>
                                                        </div>


                                                        <div class="row">
                                                            <br/>
                                                            <label for="linkageDateStr">Fecha</label>

                                                            <div class="input-group input-large">
                                                                <input class="form-control date-picker"
                                                                       id="linkageDateStr" data-date-format="yyyy/mm/dd"
                                                                       name="linkageDateStr" ng-model="m.linkageDate"
                                                                       type="text" readonly data-val="true"
                                                                       data-val-required="Fecha es un campo requerido">
                <span class="input-group-addon">
                    <i class="icon-calendar bigger-110"></i>
                </span>
                                                            </div>
                         <span class="field-validation-valid" data-valmsg-for="linkageDateStr"
                               data-valmsg-replace="true"></span>
                                                        </div>

                                                        <div class="row">
                                                            <br/>
                                                            <label for="linkageTimeStr">Hora</label>

                                                            <div class="input-group bootstrap-timepicker">
                                                                <input id="linkageTimeStr" name="linkageTimeStr"
                                                                       ng-model="m.linkageTime"
                                                                       readonly type="text"
                                                                       class="form-control umeca-time-picker"
                                                                       data-val="true"
                                                                       data-val-required="Hora es un campo requerido"/>
                                                        <span class="input-group-addon"><i
                                                                class="icon-time bigger-110"></i></span>
                                                                <br/>
                                                            </div>
                        <span class="field-validation-valid" data-valmsg-for="initTimeStr"
                              data-valmsg-replace="true"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <br/>
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>

                    <br/>
                </div>
            </div>
        
        <br/>

        @*<div class="row" ng-show="m.vincProcess==1||m.vincProcess==3" id="divCitaUmeca">
            <div class="widget-box">
                <div class="widget-header">Cita UMECA para entrevista de encuadre</div>
                <div class="widget-body">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <br/>

                            <div row>
                                <div class="col-xs-3">
                                    <label for="appointmentDateStr">Cita en la UMECA:</label>
                                    <br/>

                                    <div class="input-group">
                                        <input id="umecaDateStr" name="umecaDateStr"
                                               ng-model="m.umecaDate"
                                               class="form-control date-picker" id="id-date-picker-umeca" type="text"
                                               data-date-format="yyyy/mm/dd" data-val="true" readonly
                                               data-val-required="Cita en la UMECA es un campo requerido"/>
                                    <span class="input-group-addon">
                                        <i class="icon-calendar bigger-110"></i>
                                    </span>
                                    </div>
                                <span class="field-validation-valid" data-valmsg-for="umecaDateStr"
                                      data-valmsg-replace="true"></span>
                                </div>
                                <div class="col-xs-3">
                                    <label for="umecaTimeStr">Hora de la cita UMECA</label>

                                    <div class="input-group bootstrap-timepicker">
                                        <input id="umecaTimeStr" name="umecaTimeStr" ng-model="m.umecaTime"
                                               readonly type="text" class="form-control umeca-time-picker"
                                               data-val="true"
                                               data-val-required="Hora de inicio es un campo requerido"/>
                                                        <span class="input-group-addon"><i
                                                                class="icon-time bigger-110"></i></span>
                                        <br/>
                                    </div>
                        <span class="field-validation-valid" data-valmsg-for="umecaTimeStr"
                              data-valmsg-replace="true"></span>
                                </div>
                                <div class="col-xs-5">
                                    <label>Elige el nuevo supervisor para el caso</label>
                                    <br/>
                                    <select class="form-control element-center"
                                            ng-model="m.umecaSupervisor"
                                            ng-options="e.description for e in lstSupervisor"
                                            ng-init='lstSupervisor = ${lstSupervisor};' 
                                            ></select>
                                </div>
                                <br/>
                                <br/>
                                <br/>
                                <br/>
                                <br/>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>

        <br/>*@

        <div id="divMedidasHidden">
            <input type="hidden" name="nationalArrangement" value="{{m.nationalArrangement}}"/>
            <input type="hidden" name="arrangementType" value="{{m.arrType}}"/>
        </div>

        <div class="row" ng-show="m.vincProcess==1||m.vincProcess==3" id="divMedidas">
            <div class="widget-box">
                <div class="widget-header">Obligaciones procesales</div>
                <div class="widget-body">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <br/>

                            <div class="col-xs-12">
                                <div class="widget-box">
                                    <div class="widget-header">Audiencia</div>
                                    <div class="widget-body">
                                        <div class="row">
                                            <div class="col-xs-10 col-xs-offset-1">
                                                <br/>

                                                <div class="element-left">
                                        <span class="field-validation-valid" data-valmsg-for="nationalArrangement"
                                              data-valmsg-replace="true"></span>
                                                </div>

                                                <div class="col-xs-3">
                                                    <div class="radio">
                                                        <label ng-click="loadArrangements()">
                                                            <input name="nationalArrangement" class="ace" type="radio"
                                                                   value="true"
                                                                   ng-model="m.nationalArrangement"
                                                                   ng-checked="m.nationalArrangement==true"
                                                                   data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;Nacional</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-click="loadArrangements()">
                                                            <input name="nationalArrangement" class="ace" type="radio"
                                                                   value="false"
                                                                   ng-model="m.nationalArrangement"
                                                                   ng-checked="m.nationalArrangement==false" checked>
                                                            <span class="lbl">&nbsp;&nbsp;Local</span>
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="col-xs-3">
                                                    <div class="radio">
                                                        <label ng-click="loadArrangements()">
                                                            <input name="arrangementType" class="ace" type="radio"
                                                                   value="2"
                                                                   ng-model="m.arrType" ng-checked="m.arrType==2"
                                                                   data-val="true"
                                                                   data-val-required="Debe seleccionar un valor">
                                                            <span class="lbl">&nbsp;&nbsp;SCPP</span>
                                                        </label>
                                                        <br/>
                                                        <label ng-click="loadArrangements()">
                                                            <input name="arrangementType" class="ace" type="radio"
                                                                   value="1"
                                                                   ng-model="m.arrType" ng-checked="m.arrType==1">
                                                            <span class="lbl">&nbsp;&nbsp;MC</span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div ng-show="m.arrType>0&&m.nationalArrangement!=undefined"
                                                     class="col-xs-6">
                                                    <label ng-bind-html="lblTerms"></label>
                                                    <br/>
                                            <textarea class="form-control limited" name="terms"
                                                      ng-model="m.terms"
                                                      maxlength="980"
                                                      data-val="true"
                                                      data-val-required="Plazo es un campo requerido">
                                            </textarea>
                                        <span class="field-validation-valid" data-valmsg-for="terms"
                                              data-valmsg-replace="true"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <br/>

                                        <div class="row">
                                            <div class="col-xs-10 col-xs-offset-1">
                                        <span ng-class='m.errArrmntSel&&m.errArrmntSel!="" ? "field-validation-error" : "input-validation-valid"'
                                              ng-bind-html="m.errArrmntSel"></span>

                                                <div class="row" ng-repeat="arrangment in m.lstArrangementShow">
                                                    <div class="checkbox">
                                                        <label ng-click="validateArrangementSel($index,arrangment.id);">
                                                            <input class="ace arrangBoxSelector" id="arrangement{{arrangment.id}}"
                                                                   ng-disabled=" m.disableAll==true || (arrangment.isDefault==true && arrangment.selVal==true) "
                                                                   type="checkbox"
                                                                   ng-model="m.lstArrangementShow[$index].selVal">
                                                            <span class="lbl col-xs-10">&nbsp;&nbsp;{{arrangment.name}}</span>
                                                        </label>
                                                    </div>
                                                    <br/>

                                                    <div class="col-xs-offset-1">
                                                <textarea class="form-control limited arrangTextDescriptor" ng-disabled="m.disableAll==true"
                                                          ng-blur="validateArrangementSel()"
                                                          maxlength="980"
                                                          ng-model="m.lstArrangementShow[$index].description"
                                                          ng-show="m.lstArrangementShow[$index].selVal==true">{{m.lstArrangementShow[$index].description}}</textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br/>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>

        <br/>

        <div class="row" ng-show="m.vincProcess==1||m.vincProcess==3" id="divContact">
            <div class="widget-box">
                <div class="widget-header">Datos de contacto</div>
                <div class="widget-body">
                    <br/>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">

                            <div class="col-xs-12">
                                <label for="contactName">&iquest;Tiene contactos?</label>
                                <br/>

                                <div class="radio">
                                    <label ng-click="hasContacts(1)">
                                        <input class="ace" type="radio" value="1" ng-model="m.rdHasContacts"
                                               ng-checked="m.rdHasContacts==1">
                                        <span class="lbl">&nbsp;&nbsp;Si</span>
                                    </label>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                    <label ng-click="hasContacts(2)">
                                        <input class="ace" type="radio" value="2" ng-model="m.rdHasContacts"
                                               ng-checked="m.rdHasContacts==2">
                                        <span class="lbl">&nbsp;&nbsp;No</span>
                                    </label>
                                </div>
                            </div>

                        </div>
                    </div>

                    <br/>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">

                            <div class="col-xs-3">
                                <label for="contactName">Nombre</label>
                                <br/>
                                <input id="contactName" type="text"
                                       class="input-xxlarge" ng-model="m.contactName"/>
                                <br/>
                            </div>

                            <div class="col-xs-3">
                                <label for="contactPhone">Tel&eacute;fono:</label>
                                <br/>
                                <input id="contactPhone" type="text"
                                       class="input-xxlarge" ng-model="m.contactPhone"/>
                                <br/>
                            </div>


                            <div class="col-xs-4">
                                <label>Direcci&oacute;n</label>
                                <br/>
                        <textarea class="input-xxlarge form-control limited" id="contactAddress"
                                  maxlength="980" ng-model="m.contactAddress">
                        </textarea>
                            </div>

                            <div class="col-xs-2 element-right">
                                <br/>
                                <button type="button" class="btn btn-info" ng-click="addContact();">
                                    <i class="icon-plus bigger-110"></i>
                                    Agregar
                                </button>
                            </div>


                        </div>
                    </div>
                    <br/>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <div ng-show="MsgErrorContact!=''" class="alert alert-danger element-center">
                                <span>{{MsgErrorContact}}</span>
                            </div>
                        </div>
                    </div>

                    <br/>

                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">

                            <div class="widget-box">
                                <div class="widget-header">Lista de contactos</div>
                                <div class="widget-body">
                                    <div class="widget-main no-padding">
                                        <table class="table table-striped table-bordered table-hover">
                                            <thead class="thin-border-bottom">
                                            <tr>
                                                <th class="element-center">Nombre</th>
                                                <th class="element-center">Tel&eacute;fono</th>
                                                <th class="element-center">Direcci&oacute;n</th>
                                                <th class="element-center">Quitar</th>
                                            </tr>
                                            </thead>

                                            <tbody>
                                            <div>
                                                <tr ng-repeat="contact in m.lstContactData track by $index">
                                                    <td class="element-center">{{contact.NameTxt}}</td>
                                                    <td class="element-center">{{contact.PhoneTxt}}</td>
                                                    <td class="element-center">{{contact.AddressTxt}}</td>
                                                    <td class="element-center"><a href="javascript:;"
                                                                                  style="display:inline-block;"
                                                                                  title="Quitar de la lista"
                                                                                  ng-click="removeContact($index)"><span
                                                            class="glyphicon glyphicon-minus blue"></span></a></td>
                                                </tr>
                                            </div>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <br/>

                        <div class="row">
                            <div class="col-xs-10 col-xs-offset-1">
                                <div class="col-xs-6">
                                    <br/>
                                    <label>Observaciones</label>
                                    <br/>
                            <textarea class="input-xxlarge form-control limited" name="comments"
                                      ng-model="m.comments"
                                      maxlength="980" data-val="true"
                                      data-val-required="Observaciones un campo requerido">
                            </textarea>
        <span class="field-validation-valid" data-valmsg-for="comments"
              data-valmsg-replace="true"></span>
                                </div>
                            </div>
                        </div>

                    </div>
                    <br/>

                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-xs-12">
                <div ng-show="MsgError&&MsgError!=''" class="alert alert-danger element-center">
                    <p ng-bind-html="MsgError"></p>
                </div>
            </div>
        </div>

        <div class="row element-right">
            <div class="col-xs-6">
                <h3 class="header smaller lighter blue element left">
                    <small>Nombre del supervisor:</small>
                    &nbsp;&nbsp;{{m.userName}}
                </h3>
            </div>
            <div class="col-xs-6" ng-show="m.isFinished==true">
                <h3 class="header smaller lighter blue element left">
                    <small>Hora de t&eacute;rmino:</small>
                    &nbsp;&nbsp;{{m.endTime}}
                </h3>
            </div>

            <div class="col-xs-6 element-right">
                <div>
                            <span class="btn btn-default btn-sm"  onclick="regresar(@Model.IdCase);" >
                                  <!--ng-click="returnUrl('<c:url value='/supervisor/hearingFormat/indexFormats.html'/>'+'?id='+m.idCase)">-->
                                Regresar
                            </span>
                            <span class="btn btn-default btn-primary btn-sm notAviable" ng-disabled="WaitFor==true"  ng-click="submitPartiaSaveHF();" >
                                  <!--ng-click="submitPartiaSaveHF('#FormFormatId','<c:url value='/supervisor/hearingFormat/doUpsert.json'/>');">-->
                                Guardar
                            </span>
                </div>
            </div>
        </div>

        <div class="row">
            <div id="finishConfirm" class="modal-footer" ng-show="m.canSave==true">
                    <span class="btn btn-default btn-primary btn-sm" ng-disabled="WaitFor==true" onclick="askVerificationTerminate.show();" > 
                          Terminar
                    </span>
            </div>
        </div>

        <script>
    var date = new Date();
    date.setFullYear(date.getFullYear() - 18);
    $('#imputedBirthDateStr').datepicker({autoclose: true, endDate: date}).next().on(ace.click_event, function () {
        $(this).prev().focus();
    });
</script>
<script>
var askVerificationTerminate  = {};

askVerificationTerminate.show = function (){
	var dlgMsgBox = $('#askVerificationTerminateBoxDlgId');
	dlgMsgBox.show();
};

askVerificationTerminate.hide = function (){
	var dlgMsgBox = $('#askVerificationTerminateBoxDlgId');
	dlgMsgBox.hide();
};
    	</script>
<div class="modal-dialog" style="display:none; width:60%; position: fixed;top: 15%;left: 50%;margin: 0 0 0 -30%;" id="askVerificationTerminateBoxDlgId" >
        <div class="modal-content" style="z-index: 1000;">
            <div class="modal-header">
                <div class="alert alert-info">
                    <button id="askVerificationTerminateBoxDlgXclose" type="button" class="close" onclick="javascript:askVerificationTerminate.hide();">×</button>
                    <h4 class="modal-title element-center ng-binding">Terminar formato de audiencia</h4>
                </div>
            </div>
            <div class="modal-body">
                <div class="element-center ng-binding">¿Está seguro que desea terminar el formato de audiencia?</div>
            </div>
            <div class="modal-footer">
                <button id="MessageBoxDlgYes" type="button" class="btn btn-default btn-primary" ng-click="saveHF();" >Si</button>
                <button id="MessageBoxDlgNo" type="button" class="btn btn-default" onclick="javascript:askVerificationTerminate.hide();" >No</button>
            </div>
        </div>
        <div class="blocker" style="z-index:999;">
		    <div>
		        Cargando...<img src="content/images/ajax_loader.gif" alt="no content detected" />
		    </div>
		</div>
    </div>



      <!--  <% include file="/WEB-INF/jsp/shared/sharedSvc.jsp" %>
        <% include file="/WEB-INF/jsp/shared/footer.jsp" %> -->
    </div>
</div>
</form>

